# ميزة تتبع تواريخ إدخال الكميات والتاريخ الميلادي

## نظرة عامة

تم إضافة ميزتين مهمتين لنظام إدارة المخزون:

### 1. التاريخ الميلادي
- عرض التاريخ الميلادي الحالي في أعلى صفحة إدارة المخزون
- تنسيق التاريخ باللغة العربية مع اليوم والشهر والسنة
- عرض اليوم من الأسبوع أيضاً

### 2. تتبع تواريخ إدخال الكميات
- تسجيل كل عملية إضافة كمية للمنتجات مع التاريخ والوقت
- إمكانية معرفة عدد مرات إضافة الكميات لكل منتج
- عرض تفاصيل كل عملية إدخال (الكمية، التاريخ، الوقت، المستخدم)
- إحصائيات شاملة لكل منتج

## الميزات الجديدة

### جدول تتبع الكميات (stock_entries)
```sql
- id: معرف فريد للعملية
- product_id: معرف المنتج
- product_name: اسم المنتج وقت الإدخال
- item_code: كود الصنف
- quantity_added: الكمية المضافة
- previous_stock: المخزون قبل الإضافة
- new_stock: المخزون بعد الإضافة
- entry_date: تاريخ الإدخال (ميلادي)
- entry_time: وقت الإدخال
- entry_datetime: التاريخ والوقت الكامل
- notes: ملاحظات
- entered_by: اسم المستخدم
- user_id: معرف المستخدم
- warehouse_id: معرف المخزن
```

### واجهة المستخدم الجديدة

#### زر تاريخ الإدخال
- زر بنفسجي اللون مع أيقونة التقويم في جدول المنتجات
- يفتح نافذة تفصيلية لعرض تاريخ إدخال الكميات

#### نافذة تاريخ الإدخال
- **بطاقات الإحصائيات:**
  - المخزون الحالي
  - إجمالي الكميات المضافة
  - عدد مرات الإدخال
  - متوسط الكمية لكل إدخال

- **نموذج إضافة كمية جديدة:**
  - حقل الكمية (مطلوب)
  - حقل الملاحظات (اختياري)
  - زر الإضافة مع تأكيد

- **جدول تاريخ العمليات:**
  - التاريخ الميلادي مع أيقونة التقويم
  - الوقت مع أيقونة الساعة
  - الكمية المضافة (بشارة خضراء)
  - المخزون السابق والجديد
  - اسم المستخدم الذي أدخل الكمية
  - الملاحظات

## كيفية الاستخدام

### 1. عرض تاريخ إدخال الكميات
1. اذهب إلى صفحة إدارة المخزون
2. ابحث عن المنتج المطلوب في الجدول
3. اضغط على الزر البنفسجي (أيقونة التقويم) في عمود الإجراءات
4. ستفتح نافذة تعرض تاريخ جميع عمليات الإدخال

### 2. إضافة كمية جديدة
1. في نافذة تاريخ الإدخال، اضغط على زر "إضافة"
2. أدخل الكمية المطلوبة
3. أضف ملاحظات إذا لزم الأمر
4. اضغط "إضافة الكمية"
5. ستُسجل العملية تلقائياً مع التاريخ والوقت

### 3. مراجعة الإحصائيات
- المخزون الحالي: الكمية الموجودة حالياً
- إجمالي الكميات المضافة: مجموع كل الكميات التي تم إدخالها
- عدد مرات الإدخال: كم مرة تم إضافة كميات لهذا المنتج
- متوسط الكمية: متوسط الكمية في كل عملية إدخال

## التحديثات التقنية

### قاعدة البيانات
- إنشاء جدول `stock_entries` جديد
- إضافة فهارس لتحسين الأداء
- إضافة triggers لتحديث التواريخ تلقائياً

### الكود
- تحديث أنواع البيانات في TypeScript
- إضافة دوال جديدة في `lib/database.ts`
- إنشاء مكون `StockEntriesDialog` جديد
- تحديث صفحة المخزون لدعم الميزات الجديدة

### الأمان
- التحقق من صلاحيات المستخدم
- التحقق من صحة البيانات المدخلة
- حماية من SQL Injection
- تسجيل جميع العمليات مع معرف المستخدم

## التثبيت

### 1. تشغيل Migration
```sql
-- في Supabase SQL Editor، قم بتشغيل محتوى ملف:
scripts/run-migration.sql
```

### 2. إعادة تشغيل التطبيق
```bash
npm run dev
```

## الملفات المضافة/المحدثة

### ملفات جديدة:
- `supabase/migrations/20250929_stock_entries_tracking.sql`
- `components/stock-entries-dialog.tsx`
- `components/ui/scroll-area.tsx`
- `components/ui/separator.tsx`
- `scripts/run-migration.sql`
- `STOCK_ENTRIES_FEATURE.md`

### ملفات محدثة:
- `lib/supabase.ts` - إضافة أنواع البيانات الجديدة
- `lib/database.ts` - إضافة دوال إدارة الكميات
- `app/inventory/page.tsx` - إضافة واجهة المستخدم الجديدة

## مثال على الاستخدام

### سيناريو: منتج "آلة عد النقود ABC-123"
1. **الإدخال الأول:** 29/9/2025 - إضافة 100 قطعة
2. **الإدخال الثاني:** 10/10/2025 - إضافة 50 قطعة

### النتيجة في النظام:
- **المخزون الحالي:** 150 قطعة (بعد خصم أي مبيعات)
- **إجمالي الكميات المضافة:** 150 قطعة
- **عدد مرات الإدخال:** 2 مرة
- **متوسط الكمية:** 75 قطعة لكل إدخال

### عرض التاريخ:
```
التاريخ الميلادي    الوقت      الكمية المضافة    المخزون السابق    المخزون الجديد
10/10/2025      14:30        +50              100             150
29/09/2025      09:15        +100             0               100
```

## الفوائد

1. **تتبع دقيق:** معرفة متى وكم مرة تم إضافة كميات لكل منتج
2. **شفافية:** رؤية كاملة لتاريخ المخزون
3. **مراجعة:** إمكانية مراجعة العمليات السابقة
4. **إحصائيات:** بيانات مفيدة لاتخاذ القرارات
5. **أمان:** تسجيل كل العمليات مع معرف المستخدم
6. **سهولة الاستخدام:** واجهة بسيطة وواضحة

## ملاحظات مهمة

- يتم تسجيل عملية إدخال تلقائية عند إنشاء منتج جديد بكمية أكبر من صفر
- جميع التواريخ والأوقات محفوظة بالتوقيت المحلي
- يمكن إضافة ملاحظات لكل عملية إدخال لتوضيح السبب
- النظام يحفظ اسم المنتج وكود الصنف وقت الإدخال لضمان الدقة حتى لو تغيرت لاحقاً