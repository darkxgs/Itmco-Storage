# قائمة المهام المطلوبة

## 1. سعر البيع المخصص في صفحة الإصدارات ✅
**الوصف:** إضافة حقل سعر بيع مخصص لكل إصدار (يختلف عن سعر البيع الأساسي للمنتج)

**التفاصيل:**
- [x] إضافة حقل `customSellingPrice` في نموذج الإصدار (يظهر فقط عند اختيار "بدون ضمان")
- [x] الحقل اختياري - إذا لم يُملأ يستخدم سعر البيع الأساسي من المنتج
- [x] عرض إجمالي السعر (الكمية × سعر البيع) تحت حقل الضمان
- [x] حفظ سعر البيع المخصص في الملاحظات (لأن العمود غير موجود في قاعدة البيانات)

**ملاحظة:** السعر يُحفظ في الملاحظات بصيغة "سعر البيع: XXX"

---

## 2. إصلاح البحث في سجل الإصدارات ✅
**المشكلة:** عند كتابة اسم العميل في البحث، تختفي جميع النتائج

**الحل:**
- [x] مراجعة دالة `filteredIssuances` في صفحة الإصدارات
- [x] التأكد من أن البحث يعمل على `customer_name` و `customerName`
- [x] إصلاح منطق الفلترة ليعرض النتائج بشكل صحيح
- [x] إضافة البحث في اسم المنتج أيضاً

---

## 3. إضافة عمود الربح في تقرير Excel ✅
**الوصف:** إضافة عمود "الربح" بعد عمود "سعر البيع" في تقرير Excel

**التفاصيل:**
- [x] إضافة عمود "الربح" = سعر البيع - سعر الشراء
- [x] حساب الربح تلقائياً في التصدير
- [x] الترتيب: سعر الشراء → سعر البيع → الربح

---

## 4. إصلاح تعديل كود الصنف في إدارة المخزون ✅
**المشكلة:** زر "حفظ التعديلات" يختفي بسرعة عند تعديل كود الصنف

**الحل:**
- [x] جعل التعديل مباشر في الجدول (inline editing)
- [x] حفظ التعديلات تلقائياً عند الخروج من الحقل (onBlur) أو الضغط على Enter
- [x] إمكانية الإلغاء بالضغط على Escape
- [x] النقر على كود الصنف يفتح حقل التعديل مباشرة

---

## حالة التنفيذ:
| المهمة | الحالة |
|--------|--------|
| سعر البيع المخصص | ✅ مكتمل |
| إصلاح البحث | ✅ مكتمل |
| عمود الربح في Excel | ✅ مكتمل |
| إصلاح تعديل كود الصنف | ✅ مكتمل |

---

## ملخص التغييرات:

### 1. سعر البيع المخصص (app/issuance/page.tsx)
- إضافة state: `customSellingPrice`
- حقل إدخال يظهر فقط عند "بدون ضمان"
- عرض إجمالي السعر في صندوق أخضر
- حفظ السعر في الملاحظات

### 2. إصلاح البحث (app/issuance/page.tsx)
- تحسين منطق `filteredIssuances`
- البحث في: اسم العميل، المهندس، السريال، اسم المنتج
- معالجة الحالات الفارغة

### 3. عمود الربح (lib/export-utils.ts)
- إضافة "الربح" في TABLE_HEADERS
- حساب: الربح = سعر البيع - سعر الشراء
- إضافة في mapRowForStrings و tableData

### 4. تعديل كود الصنف (app/inventory/page.tsx)
- states: `editingItemCodeId`, `editingItemCodeValue`
- دالة `handleSaveItemCode`
- تعديل مباشر بالنقر على الكود
- حفظ: onBlur أو Enter | إلغاء: Escape
